<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Gallery</title>
    <link rel="stylesheet" href="./public/styles/styles.css">
</head>

<body>
    <header>
        <div class="logo">
            <img src="./public/youtube-icon.png" alt="Mini YouTube">
            <span>Mini YouTube</span>
        </div>
        <nav>
            <ul>
                <li><a href="/">Ana SÉ™hifÉ™</a></li>
                <li><a href="/download.html">Download</a></li>
            </ul>
        </nav>
        <button id="play-music">Musiqi BaÅŸlat</button>
        <br>
        <h3>Youtube videos</h3>
    </header>

    <main>
        <section id="video-gallery">
            <!-- Videolar dinamik olaraq JavaScript ilÉ™ buraya É™lavÉ™ edilÉ™cÉ™k -->
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Mini YouTube</p>
    </footer>

    <!-- JavaScript faylÄ± buraya É™lavÉ™ edirik -->
    <script>
    // Sayt yÃ¼klÉ™ndikdÉ™n sonra videolarÄ± gÉ™tir
document.addEventListener('DOMContentLoaded', () => {
    async function fetchVideos() {
        try {
            const response = await fetch('/api/videos'); // VideolarÄ± alÄ±rÄ±q
            const videos = await response.json(); // JSON-a Ã§eviririk

            const videoGallery = document.getElementById('video-gallery');
            videoGallery.innerHTML = ''; // HÉ™r dÉ™fÉ™ tÉ™mizlÉ™yirik

            videos.forEach(video => {
                const videoElement = document.createElement('div');
                videoElement.classList.add('video-item');

                // Embed link yaratmaq Ã¼Ã§Ã¼n
                const embedLink = video.source.replace('watch?v=', 'embed/');

                videoElement.innerHTML = `
                    <iframe width="100%" height="250" src="${embedLink}" frameborder="0" allowfullscreen=true></iframe>
                    <h4>${video.title}</h4>
                    <button class="delete-btn" data-id="${video._id}">ğŸ—‘ï¸ Sil</button>
                `;

                videoGallery.appendChild(videoElement);
            });

            // "Sil" dÃ¼ymÉ™si Ã¼Ã§Ã¼n event listener É™lavÉ™ edirik
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', async function () {
                    const videoId = this.getAttribute('data-id');
                    await deleteVideo(videoId); // Videonu silÉ™n funksiyanÄ± Ã§aÄŸÄ±rÄ±rÄ±q
                });
            });

        } catch (err) {
            console.error('VideolarÄ± É™ldÉ™ etmÉ™kdÉ™ problem yaÅŸandÄ±:', err);
        }
    }

    // Videonu backend-dÉ™n silmÉ™k Ã¼Ã§Ã¼n funksiya
    async function deleteVideo(videoId) {
        try {
            const response = await fetch(`/api/videos/${videoId}`, {
                method: 'DELETE',
            });
            if (response.ok) {
                alert('Video uÄŸurla silindi.');
                fetchVideos(); // VideolarÄ± yenidÉ™n yÃ¼klÉ™yirik
            } else {
                alert('Videonu silmÉ™kdÉ™ problem yaÅŸandÄ±.');
            }
        } catch (err) {
            console.error('Videonu silmÉ™kdÉ™ problem yaÅŸandÄ±:', err);
        }
    }

    // Ä°lk yÃ¼klÉ™nmÉ™ zamanÄ± videolarÄ± alÄ±rÄ±q
    fetchVideos();
});

    </script>
</body>

</html>
